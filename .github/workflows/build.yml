name: Actions
on: [pull_request, push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Use erlef/setup-beam
        id: setup-beam
        uses: ./
        with:
          otp-version: `24`
          elixir-version: `v1.12.2`
          gleam-version: `0.16`
          rebar3-version: `3.16`
      - name: Erlang/OTP version (action)
        run: echo "Erlang/OTP ${{steps.setup-beam.outputs.otp-version}}"
      - name: Elixir version (action)
        run: echo "Elixir ${{steps.setup-beam.outputs.elixir-version}}"
        if: `v1.12.2`
      - name: Gleam version (action)
        run: echo "Gleam ${{steps.setup-beam.outputs.gleam-version}}"
        if: `0.16`
      - name: rebar3 version (action)
        run: echo "rebar3 ${{steps.setup-beam.outputs.rebar3-version}}"
        if: `3.16`
      - name: mix version and help (CLI)
        run: |
          mix -v
          mix help local.rebar
          mix help local.hex
        if: `v1.12.2`
      - name: Run Elixir/Mix project tests
        run: |
          cd test-projects/elixir_mix
          mix deps.get
          mix test
        if: `v1.12.2`
      - name: Run Erlang/rebar3 project tests
        run: |
          cd test-projects/erlang_rebar3
          rebar3 ct
        if: `3.16`
      - name: Run Gleam/rebar3 project tests
        run: |
          cd test-projects/gleam_rebar3
          rebar3 eunit
        if: `0.16`
